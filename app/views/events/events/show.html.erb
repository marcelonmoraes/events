<div class="events-dashboard">
  <p><%= link_to "Back to events", events_path, class: "events-link" %></p>

  <h1>Event #<%= @event.id %></h1>

  <table class="events-detail">
    <tr>
      <th>Name</th>
      <td><span class="events-badge"><%= @event.name %></span></td>
    </tr>
    <% if @event.parent %>
    <tr>
      <th>Parent</th>
      <td><%= link_to "Event ##{@event.parent_id}", event_path(@event.parent), class: "events-link" %></td>
    </tr>
    <% end %>
    <tr>
      <th>Source</th>
      <td><span class="events-badge events-badge--source"><%= @event.source %></span></td>
    </tr>
    <tr>
      <th>Actor</th>
      <td><%= @event.actor ? "#{@event.actor_type}##{@event.actor_id}" : "-" %></td>
    </tr>
    <tr>
      <th>Target</th>
      <td><%= @event.target ? "#{@event.target_type}##{@event.target_id}" : "-" %></td>
    </tr>
    <tr>
      <th>Metadata</th>
      <td><pre class="events-json"><%= JSON.pretty_generate(@event.metadata) %></pre></td>
    </tr>
    <tr>
      <th>IP address</th>
      <td><%= @event.ip_address || "-" %></td>
    </tr>
    <tr>
      <th>User agent</th>
      <td><%= @event.user_agent || "-" %></td>
    </tr>
    <tr>
      <th>Request ID</th>
      <td><%= @event.request_id || "-" %></td>
    </tr>
    <tr>
      <th>Created at</th>
      <td><%= @event.created_at.strftime("%Y-%m-%d %H:%M:%S %Z") %></td>
    </tr>
  </table>

  <% if @children.any? %>
    <h2>Sub-events</h2>

    <table class="events-table">
      <thead>
        <tr>
          <th>Time</th>
          <th>Name</th>
          <th>Source</th>
          <th>Actor</th>
          <th>Target</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @children.each do |child| %>
          <tr>
            <td class="events-time"><%= child.created_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
            <td><span class="events-badge"><%= child.name %></span></td>
            <td><span class="events-badge events-badge--source"><%= child.source %></span></td>
            <td><%= child.actor ? "#{child.actor_type}##{child.actor_id}" : "-" %></td>
            <td><%= child.target ? "#{child.target_type}##{child.target_id}" : "-" %></td>
            <td><%= link_to "Detail", event_path(child), class: "events-link" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>
